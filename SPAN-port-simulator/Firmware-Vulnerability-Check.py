import json
import time
from datetime import datetime

def simulate_firmware_check():
    while True:
        with open("firmware_vulnerability_check.json", "r") as f:
            data = json.load(f)
        print("\n=== Firmware Vulnerability Check Stream ===")
        print("Starting scan at", datetime.now().strftime("%Y-%m-%d %H:%M:%S"))
        print("============================================\n")
        
        for entry in data:
            timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
            print(f"[{timestamp}] Scanning device: {entry.get('device_id', 'Unknown')}")
            print(f"├── Firmware Version: {entry.get('firmware_version', 'Unknown')}")
            print(f"├── Vulnerability Found: {entry.get('vulnerability_found', False)}")
            if entry.get('vulnerability_details'):
                print(f"├── Details: {entry['vulnerability_details']}")
            print(f"└── Risk Level: {entry.get('risk_level', 'Unknown')}\n")
            time.sleep(0.5)
        
        print("\nRestarting scan...\n")
        time.sleep(1)

if __name__ == "__main__":
    try:
        simulate_firmware_check()
    except KeyboardInterrupt:
        print("\nStopping firmware vulnerability check stream...")
